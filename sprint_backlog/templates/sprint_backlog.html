{% extends 'base_logged_in.html' %}
{% block content %}
<script>
    $(document).on("click", ".img-add-task", function (e) {
        let _self = $(this);
        let id = _self.data('pbi-id');
        $("#pbi-id").val(id);
    });

    function editTask(taskID) {
        axios.post(`http://127.0.0.1:8000/editTask/`, {taskID: taskID}).then((res) => {
            $("#editModal").html(res.data);
        });
    }

</script>
<div style="width: 100%; align-items: center; flex-direction: row; display: flex; justify-content: center;">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center justify-content-center align-items-center">
            <span class="text-white">{{error_message}}</span>
            {% if enable_add_sprint %}
            <form action="" class="form-group col-md-12" method="post">
                {{create_sprint.as_table}}
                {% csrf_token %}
                <button type="submit" class="btn btn-dark button-submit" value="sprintBacklog/">Create Sprint</button>
            </form>
            {% endif %}
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModal" tabindex="1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create A Task</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="addTask/" class="form-group col-md-12" method="post">
                    {{add_task_form.as_table}}
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </form>
            </div>

        </div>
    </div>
</div>
<div class="modal" id="editModal" tabindex="1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">

</div>
<br/>
<div style="display: flex; flex-direction: column; width: 100%;">
    <div class="row align-items-center align-self-center" style="width: 80%;">
        <div class="col" style="text-align: center;">Product Backlog</div>
        <div class="col-8" style="text-align: center;">Tasks</div>
        <div class="col" style="text-align: center;">Status</div>
    </div>
    {% for e in product_backlogs %}
    <div class="row align-items-center align-self-center" style="width: 80%;">
        <div class="col">{{e.product_backlog_title}}</div>
        <div class="col-8">
            <div class="row" style="flex-wrap: wrap;">
                {% for task in e.task_id.all %}
                <div class="card" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">{{task.title}}</h5>
                        <p class="card-text">{{task.description}}.</p>
                        <button onclick="editTask(`{{task.task_id}}`);" data-target="#editModal" data-toggle="modal"
                                class="btn btn-primary">Go somewhere
                        </button>
                    </div>
                </div>
                {% endfor %}
                <img src="../static/images/add.png" style="object-fit: contain; height: 100px; width: 100px;"
                     class="img-add-task"
                     data-toggle="modal"
                     data-pbi-id="{{e.product_backlog_id}}"
                     data-target="#exampleModal"/>
            </div>
        </div>
        <div class="col">Status</div>
    </div>
    {% endfor %}

</div>
{% endblock %}
